---
import type { Cookies, Post } from 'types/utils';
import TagHeading from './common/TagHeading.astro';
import { Link } from '@components/common/link';
import { getRelatedArticles, isUserAdmin } from '@js/utils';
import PostCardContainer from './postcard/PostCardContainer.astro';
import PostCardDetails from './postcard/PostCardDetails.astro';

const isAdmin = isUserAdmin(Astro.cookies as Cookies);

const { relatedArticles } = Astro.props;
const _relatedArticles = getRelatedArticles(isAdmin, relatedArticles);
---

{
   _relatedArticles.length > 0 && (
      <aside class="container-related-posts" aria-label="Related posts">
         <TagHeading
            classes="related-articles-heading"
            tag="h3"
            style="text-align: center; margin-bottom: 20px"
         >
            Art√≠culos Relacionados
         </TagHeading>
         {_relatedArticles.map((relatedArticle: Post) => (
            <PostCardContainer>
               <Link
                  href={`/blog/${relatedArticle.slug}`}
                  isFilled={false}
                  classes="post-link-wrapper"
                  text={relatedArticle.data.title}
               />
               <TagHeading tag="h4">
                  <Link
                     href={`/blog/${relatedArticle.slug}`}
                     isFilled={false}
                     classes="post-title"
                     text={relatedArticle.data.title}
                     data-normal-link
                  />
               </TagHeading>
               <PostCardDetails
                  author={relatedArticle.data.author}
                  date={relatedArticle.data.date as string}
               />
            </PostCardContainer>
         ))}
      </aside>
   )
}

<style is:inline>
   .container-related-posts {
      margin-top: 20px;
      & article {
         margin: 5px 0;
      }
      .post-link-wrapper {
         opacity: 0;
         position: absolute;
         top: 0;
         right: 0;
         bottom: 0;
         left: 0;
         cursor: pointer;
         overflow-wrap: anywhere;
         width: 100%;
         height: 100%;
         z-index: 10;
      }
   }
   .container-related-posts {
      & .post-card-details {
         gap: 0px;
         margin-left: auto;
         padding-left: 10px;
         .post-card-author {
            margin-right: 5px;
         }
      }
   }
</style>
