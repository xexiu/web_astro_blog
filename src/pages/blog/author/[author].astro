---
export const prerender = true;
import Posts from '@components/postcard/Posts.astro';
import TagHeading from '@components/common/TagHeading.astro';
import { slugify } from '@js/utils';
import MainLayout from '@layouts/MainLayout.astro';
import { getCollection } from 'astro:content';
import type { Post } from 'types/utils';

const isAdmin = !!Astro.cookies.get('isAdmin');

export async function getStaticPaths() {
   const blogEntries = await getCollection('blog');
   const allAuthors = [
      ...new Set(blogEntries.map((post) => post.data.author).flat()),
   ];

   return allAuthors.map((author) => {
      const authorPosts = blogEntries.filter((post) => post.data.author === author);

      return {
         params: { author: slugify(author) },
         props: {
            authorName: author,
            posts: authorPosts,
         },
      };
   });
}

const { posts, authorName } = Astro.props;
const blogs = posts.filter((entry: Post) => isAdmin ? entry : !entry.data.is_private);
---

<MainLayout title={authorName}>
   <section class="container" aria-label={`Posts by ${authorName}`}>
      <span>Publicaciones hechas por:</span>
      <TagHeading classes="post-author" tag="h1">{authorName}</TagHeading>
      <Posts entries={blogs as Post[]} />
   </section>
</MainLayout>

<style>
   .post-author {
      margin-bottom: 10px;
   }
</style>